sap.ui.define(["sap/ui/core/mvc/Controller",
		"sap/m/MessageToast",
		"sap/ui/model/json/JSONModel"
	],
	function(Controller, MessageToast, JSONModel) {
		"use strict";
		return Controller.extend("PosClient.controller.Login", {
			/**
			 *@memberOf PosClient.controller.Login
			 */

			onInit: function() {

				var storeData = {
					"selectedID": ""
				};
				var storeModel = new JSONModel(storeData);
				this.getOwnerComponent().setModel(storeModel, "storeModel");

	this.getOwnerComponent().getRouter().attachRouteMatched(this._onRouteMatched, this);
	document.addEventListener("contextmenu", function(e){
      e.preventDefault();
    }, false);
    document.addEventListener("keydown", function(e) {
    //document.onkeydown = function(e) {
      // "I" key
      if (e.ctrlKey && e.shiftKey && e.keyCode == 73) {
        disabledEvent(e);
      }
      // "J" key
      if (e.ctrlKey && e.shiftKey && e.keyCode == 74) {
        disabledEvent(e);
      }
      // "S" key + macOS
      if (e.keyCode == 83 && (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {
        disabledEvent(e); 
      }
      // "U" key
      if (e.ctrlKey && e.keyCode == 85) {
        disabledEvent(e);
      }
      // "F12" key
      if (event.keyCode == 123) {
        disabledEvent(e);
      }
    }, false);
    function disabledEvent(e){
      if (e.stopPropagation){
        e.stopPropagation();
      } else if (window.event){
        window.event.cancelBubble = true;
      }
      e.preventDefault();
      return false;
      
    };

			},

			/*onLogin: function(oEvent) {
				//This code was generated by the layout editor.
				sap.ui.getCore().getConfiguration().setLanguage( "bg" );
				
				
			},*/

			_onRouteMatched: function(oEvent) {
				if (oEvent.getParameter("name") === "login") {
					this.getView().byId("__input0").setValue("");
					this.getView().byId("__input1").setValue("");
				}
			},

			onLogin: function() {
				var that = this;
				var oBundle = this.getOwnerComponent().getModel("i18n").getResourceBundle();
				var fiscalSettingURL = oBundle.getText("fiscalSettingURL");
				var fiscalModelData = {
					status: ""
				};
				var fiscalModel = new sap.ui.model.json.JSONModel(fiscalModelData);
				that.getOwnerComponent().setModel(fiscalModel, "fiscalModel");
				$.ajax({
					type: "GET",
					url: fiscalSettingURL,
					success: function(ResponseData) {
						if (ResponseData) {
							var fiscModel = new sap.ui.model.json.JSONModel();
							fiscModel.setData(ResponseData);
							var fiscalStatusHost = fiscModel.getData()[0].ip;
							var fiscalStatusPort = fiscModel.getData()[0].port;
							var fiscalStatusUrl = "http://" + fiscalStatusHost + ":" + fiscalStatusPort + "/api";
							var fiscalData = {
								"WebSrvCmd": {
									"CmdType": fiscModel.getData()[0].cmdtype,
									"CmdPWD": "",
									"Cmd": {
										"ComPortName": fiscModel.getData()[0].comportname,
										"COMPortMsgList": [{
											"ReqCommand": {
												"Cmd": fiscModel.getData()[0].cmd,
												"CmdData": {}
											}
										}]
									}
								}
							};
							var scopeExtend = that;
							$.ajax({
								type: "POST",
								url: fiscalStatusUrl,
								data: JSON.stringify(fiscalData),
								contentType: "application/json; charset=utf-8",
								dataType: "json",
								success: function(oResponse) {
									var finalFiscalStatus = oResponse.WebSrvCmd.Res;
									if (finalFiscalStatus === "Success") {
										scopeExtend.getOwnerComponent().getModel("fiscalModel").setProperty("/status", "Fiscal Device Connected Successfully");
									} else {
										scopeExtend.getOwnerComponent().getModel("fiscalModel").setProperty("/status", "Fiscal Device Not Connected");
									}
								}

							});
						}
					}
				});

				var user = this.getView().byId("__input0").getValue();
				var password = this.getView().byId("__input1").getValue();
				//var oBundle = this.getView().getModel("i18n").getResourceBundle();
				var wrongCrednts = oBundle.getText("wrongCredentials");
				var usrData = {
					"loggedinUser": user,
					"homeButton": true,
					"backButton": false
				};

				/*if (user === "admin" && password === "admin") {
					this.getOwnerComponent().getRouter().navTo("launchPad");
				} else {
					MessageToast.show(wrongCrednts);
				}*/
				if (user === "admin" && password === "admin") {
					var uData = new JSONModel(usrData);
					this.getOwnerComponent().setModel(uData, "userData");
					this.getOwnerComponent().getRouter().navTo("launchPad", {
						user: user
					});
				} else if (user === password && user !== "") {
					this.getOwnerComponent().getRouter().navTo("launchPad", {
						user: user
					});
					var storeModel = this.getOwnerComponent().getModel("storeModel");
					storeModel.setProperty("/selectedID", user);
				} else {
					MessageToast.show(wrongCrednts);
				}
			}

		});
	});